{% extends "base.html" %} {% block title %}Cart — Revontulet Flamehouse{%
endblock %} {% block styles %}
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/cart.css') }}"
/>
{% endblock %} {% block content %}
<section class="cart-section">
    <div class="cart-header">
        <h2>Your Cart</h2>
    </div>

    <div id="cart-items" class="cart-items-container">
        <!-- Cart items will be dynamically inserted here -->
    </div>

    <div id="cart-empty" class="cart-empty">
        <p>Your cart is empty</p>
        <a href="{{ url_for('menu') }}">← Back to Menu</a>
    </div>

    <div id="cart-summary" class="cart-summary">
        <div class="summary-inner">
            <p class="summary-total">
                Total: <span id="total-price">€0.00</span>
            </p>
            <button class="btn btn-checkout">Proceed to Checkout</button>
            <a href="{{ url_for('menu') }}" class="btn btn-continue"
                >Continue Shopping</a
            >
        </div>
    </div>
</section>
{% endblock %} {% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartItemsDiv = document.getElementById("cart-items");
        const cartEmptyDiv = document.getElementById("cart-empty");
        const cartSummaryDiv = document.getElementById("cart-summary");
        const totalPriceSpan = document.getElementById("total-price");

        if (cart.length === 0) {
            cartItemsDiv.style.display = "none";
            cartEmptyDiv.style.display = "block";
            cartSummaryDiv.style.display = "none";
        } else {
            let totalPrice = 0;
            let cartHTML = "";

            cart.forEach((item, index) => {
                const itemTotal = item.price * (item.quantity || 1);
                totalPrice += itemTotal;

                cartHTML += `
                    <div class="cart-item">
                        <img src="${item.image_url}" alt="${
                    item.name
                }" class="cart-item__img">
                        <div class="cart-item__details">
                            <h3 class="cart-item__title">${item.name}</h3>
                            <p class="cart-item__desc">${item.description}</p>
                            <p class="cart-item__price">Price: <span class="amount">€${item.price.toFixed(
                                2
                            )}</span></p>
                            <div class="cart-item__controls">
                                <label class="cart-item__label">Qty:
                                    <input type="number" value="${
                                        item.quantity || 1
                                    }" min="1" class="cart-item__input" onchange="updateQuantity(${index}, this.value)">
                                </label>
                                <span class="cart-item__subtotal">Subtotal: €${itemTotal.toFixed(
                                    2
                                )}</span>
                                <button onclick="removeFromCart(${index})" class="cart-item__remove">Remove</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            cartItemsDiv.innerHTML = cartHTML;
            totalPriceSpan.textContent = "€" + totalPrice.toFixed(2);

            cartItemsDiv.style.display = "block";
            cartEmptyDiv.style.display = "none";
            cartSummaryDiv.style.display = "block";
        }
    });

    function updateQuantity(index, newQuantity) {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        if (newQuantity > 0) {
            cart[index].quantity = parseInt(newQuantity);
            localStorage.setItem("cart", JSON.stringify(cart));
            location.reload();
        }
    }

    function removeFromCart(index) {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.splice(index, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        location.reload();
    }
</script>
{% endblock %}
